# 盤點原始數據與規劃解決方案

以 Sales 資料為例，我們依據源頭資料於 MSSQL 建立對應的表。

## 1. 建立源頭資料表

以下為建立 `sales` 資料表的 SQL 語法：

```sql
-- 建立資料表
CREATE TABLE sales (
    transaction_id INT PRIMARY KEY,
    transactional_date DATETIME,
    product_id VARCHAR(255),
    customer_id INT,
    payment VARCHAR(255),
    credit_card BIGINT,
    loyalty_card VARCHAR(255),
    cost VARCHAR(255),
    quantity INT,
    price DECIMAL(18, 2)
);

-- 查詢資料
SELECT * FROM sales;
```

## 2. 導入數據：使用 MSSQL 內建工具

利用 MSSQL 內建的**匯入資料**工具導入源頭數據。

### 2.1 執行匯入精靈

> 路徑：`工作 -> 匯入資料`
<img width="863" height="722" alt="image" src="https://github.com/user-attachments/assets/af41ce7c-bf06-4a29-b513-6efab17926ad" />

### 2.2 選擇來源資料類型

> 選擇 `[Flat File Source]`
<img width="818" height="627" alt="image" src="https://github.com/user-attachments/assets/42bf2259-0c0a-4ab3-92aa-92e67d8621fb" />

### 2.3 選擇來源與目的地位置

> 確認來源檔案與目標資料庫設定
<img width="712" height="516" alt="image" src="https://github.com/user-attachments/assets/befb8827-7f4e-49a9-8ae9-9894bff7b30f" />

## 3. 檢視原始數據與欄位規劃

對於源頭來的資料，我們需要檢視欄位是否需要調整，或加入欄位以彌補缺少的維度。

首先，我們先檢視源頭資料的欄位狀況並進行規劃：

| 欄位名稱 | 欄位類型與規劃 (Data Modeling) | 備註說明 |
| :--- | :--- | :--- |
| **transaction_id** | PK (主鍵) | 已是自然鍵，作為事實表主鍵。 |
| **transactional_date** | Delta 欄位 | 時間戳記，可用於增量更新。 |
| **product_id** | 自然key  | 產品。 |
| **customer_id** | 代理鍵 (Foreign Key) | 可參照客戶維度表。 |
| **payment** | 垃圾維度 (Junk Dimension) | 支付方式相關。 |
| **loyalty_card** | 垃圾維度 (Junk Dimension) | 會員卡相關。 |
| **credit_card** | 退化維度 (Degenerate Dimension) | 交易本身的獨特屬性，不需建立維度表。 |
| **cost** | 度量/事實 (Measures/Facts) | 屬於支付維度。 |
| **quantity** | 度量/事實 (Measures/Facts) | 屬於支付維度。 |
| **price** | 度量/事實 (Measures/Facts) | 屬於支付維度。 |

## 4. 調整欄位

新增一個DateKey，作為日期的外鍵
新增計算欄位:total_price(總價)、profit(利潤)

| 欄位名稱 | 欄位類型與規劃 (Data Modeling) | 備註說明 |
| :--- | :--- | :--- |
| **transaction_id** | PK (主鍵) | 已是自然鍵，作為事實表主鍵。 |
| **transactional_date** | Delta 欄位 | 時間戳記，可用於增量更新。 |
| **product_id** | 代理鍵 (Foreign Key) | 可參照產品維度表。 |
| **customer_id** | 代理鍵 (Foreign Key) | 可參照客戶維度表。 |
| **payment** | 垃圾維度 (Junk Dimension) | 支付方式相關。 |
| **loyalty_card** | 垃圾維度 (Junk Dimension) | 會員卡相關。 |
| **credit_card** | 退化維度 (Degenerate Dimension) | 交易本身的獨特屬性，不需建立維度表。 |
| **cost** | 度量/事實 (Measures/Facts) | 屬於支付維度。 |
| **quantity** | 度量/事實 (Measures/Facts) | 屬於支付維度。 |
| **price** | 度量/事實 (Measures/Facts) | 屬於支付維度。 |

